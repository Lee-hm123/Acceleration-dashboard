# STM32 F103C8T6+ MPU6050 实时加速度仪表盘系统（基于 PyQt5 + PyQtGraph）

该系统基于 STM32 F103C8T6微控制器与 MPU6050 加速度传感器，通过串口将加速度数据发送至电脑端，利用 Python 实现实时图形化显示。采用 PyQt5 构建交互界面，PyQtGraph 实现数据可视化，适用于传感器数据展示、嵌入式项目调试、动态运动监测等场景。

------

## 🧩 系统组成

- **STM32 F103C8T6+ MPU6050 硬件模块**：采集 X/Y/Z 三轴加速度值，并以 `[ACC] X=xxxmg Y=xxxmg Z=xxxmg` 格式通过串口定时接受数据。
- **仪表盘主程序（Python）**：解析串口数据并实时绘制加速度运动轨迹与四向 G 值。
- **PyQt5 图形界面**：展示中央小球运动、轨迹线、最大 G 值、水平仪指示线等动态组件。

------

## 🚀 核心功能

- **串口数据解析**
  - 通过 `COM4` 端口监听来自 STM32 的数据。
  - 使用正则表达式匹配标准格式 `[ACC] X=xxxmg Y=xxxmg Z=xxxmg`。
  - 自动将单位 mg 转换为 g（1g = 1000mg）。
- **实时图形仪表盘**
  - 中心圆盘显示当前加速度方向。
  - 橙色小球代表当前重力加速度中心。
  - 绘制历史轨迹线（白色半透明）。
  - 四个方向实时显示当前 G 值及历史最大值（Top/Bottom/Left/Right）。
  - 水平仪（绿色线条）指示当前设备倾斜方向，支持俯仰和横滚两种角度反馈。
- **动态计算与更新**
  - 每秒刷新位置、最大值、轨迹，延迟极低。
  - 使用时间窗口保留最近 2 秒内加速度历史值，动态计算最大值。
- **安全退出**
  - 关闭窗口时自动停止串口读取，避免资源未释放。

------

## 🔧 使用说明

1. 使用 STM32 F103C8T6开发板连接 MPU6050 传感器，并通过串口将数据发送至电脑（如 COM4）。

2. 打开文件夹`MPU6050`中的Keil项目编译下载到STM32F103C8T6。

3. 确保 Python 环境安装 PyQt5 与 pyqtgraph：

   ```bash
   pip install pyqt5 pyqtgraph numpy
   ```

4. 修改程序中的串口号 `PORT = xxx ` 为你的实际串口号，本项目默认波特率为115200。

5. 运行 Python 程序：

   ```bash
   python 加速度仪表盘.py
   ```

6. 启动后将自动显示仪表盘窗口并开始接收串口数据。

------

## ⚙️ 变量说明

| 名称 / 函数                 | 类型            | 功能说明                                                     |
| --------------------------- | --------------- | ------------------------------------------------------------ |
| `PORT`                      | 字符串          | 串口号，如 `'COM4'`，根据电脑实际配置修改。                  |
| `BAUD`                      | 整数            | 串口波特率，需与 STM32 端设置一致。                          |
| `SerialThread`              | QThread 类      | 负责后台读取串口数据，并通过信号 `new_data` 实时发送给主线程。 |
| `acc_pattern`               | 正则表达式      | 用于匹配格式 `[ACC] X=xxxmg Y=xxxmg Z=xxxmg`。               |
| `new_data.emit(ax, ay, az)` | 信号机制        | 将解析后的加速度值（单位 g）传递给主线程绘图函数。           |
| `GMeter`                    | 主窗口类        | 主图形界面类，负责绘制界面元素与更新图形。                   |
| `plot`                      | PyQtGraph 组件  | 用于绘图的核心区域。                                         |
| `dot`                       | ScatterPlotItem | 中心小球，实时反映加速度方向。                               |
| `trail`                     | PlotDataItem    | 轨迹线，用于记录小球运动历史。                               |
| `g_text_cur` / `g_text_max` | 字典            | 显示四个方向（上下左右）的当前值与最大值文本。               |
| `level_line`                | LineItem        | 绿色水平仪线条，模拟倾斜方向。                               |
| `g_history`                 | 列表缓存        | 保留历史加速度值用于最大值计算。                             |
| `max_window`                | 浮点数          | 最大值计算的时间窗口（单位：秒）。                           |
| `update_plot(ax, ay, az)`   | 方法            | 主绘图逻辑，包括小球更新、文本更新、轨迹维护、水平线旋转等。 |
| `closeEvent()`              | 方法            | 关闭窗口时停止串口线程、释放资源。                           |

------

## 📷 使用效果示意图



![屏幕截图 2025-05-29 233902](https://github.com/user-attachments/assets/34e0ae8f-6384-4366-92c7-ddf404fa38fc)


